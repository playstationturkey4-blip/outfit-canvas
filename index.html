/* ============================= */
/* ===== СОХРАНЕНИЕ ОБРАЗОВ ==== */
/* ============================= */

if(!localStorage.getItem("outfits")){
  localStorage.setItem("outfits", JSON.stringify([]));
}

function saveOutfit(){

  const canvas = document.getElementById("canvas");
  const images = canvas.querySelectorAll("img");

  if(images.length === 0){
    alert("Добавьте элементы перед сохранением");
    return;
  }

  let outfits = JSON.parse(localStorage.getItem("outfits"));

  let newOutfit = [];

  images.forEach(img=>{
    newOutfit.push({
      src: img.src,
      left: img.style.left || "0px",
      top: img.style.top || "0px",
      width: img.style.width || "120px"
    });
  });

  outfits.push(newOutfit);

  localStorage.setItem("outfits", JSON.stringify(outfits));

  renderOutfits();

  alert("Образ сохранён");
}

/* ============================= */
/* ===== ОТОБРАЖЕНИЕ В ОБРАЗАХ */
/* ============================= */

function renderOutfits(){

  const gallery = document.getElementById("gallery");
  if(!gallery) return;

  gallery.innerHTML = "";

  let outfits = JSON.parse(localStorage.getItem("outfits"));

  outfits.forEach(outfit => {

    const box = document.createElement("div");
    box.className = "outfit-window";

    outfit.forEach(item => {
      const img = document.createElement("img");
      img.src = item.src;
      img.style.position = "absolute";
      img.style.left = item.left;
      img.style.top = item.top;
      img.style.width = item.width;
      box.appendChild(img);
    });

    gallery.appendChild(box);
  });
}

/* Авто-загрузка при открытии */
document.addEventListener("DOMContentLoaded", function(){
  renderOutfits();
});
