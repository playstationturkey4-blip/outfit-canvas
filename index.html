<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FOWOGES</title>

<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>

<style>
body{
  margin:0;
  font-family:'Inter',sans-serif;
  background:#0f0f0f;
  color:white;
  display:flex;
  flex-direction:column;
  height:100vh;
}

header{
  padding:20px;
  text-align:center;
  border-bottom:1px solid #1f1f1f;
}

.logo{
  font-family:'Playfair Display',serif;
  font-size:34px;
  letter-spacing:8px;
}

.nav{
  display:flex;
  justify-content:center;
  gap:25px;
  padding:10px;
  border-bottom:1px solid #1f1f1f;
}

.nav button{
  background:none;
  border:none;
  color:#aaa;
  cursor:pointer;
  font-size:14px;
}

.nav button.active{
  color:white;
  font-weight:600;
}

.screen{
  flex:1;
  display:none;
  padding:20px;
  overflow:auto;
}

.screen.active{
  display:block;
}

.hero{
  text-align:center;
  margin-top:80px;
}

.hero h1{
  font-size:48px;
  font-family:'Playfair Display',serif;
}

.hero p{
  color:#bbb;
  margin-top:15px;
}

.canvas{
  width:100%;
  height:60vh;
  background:#1a1a1a;
  border-radius:14px;
  position:relative;
  overflow:hidden;
  margin-bottom:15px;
}

.editable{
  position:absolute;
  cursor:move;
  border:2px dashed transparent;
}

.editable.active{
  border:2px dashed white;
}

.controls{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}

button.primary{
  padding:10px 16px;
  background:white;
  color:black;
  border:none;
  cursor:pointer;
  font-weight:600;
}

/* Галерея */
.gallery{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(300px,1fr));
  gap:20px;
}

.outfit-window{
  height:400px;
  background:#1a1a1a;
  border-radius:14px;
  position:relative;
  overflow:hidden;
}
</style>
</head>

<body>

<header>
  <div class="logo">FOWOGES</div>
</header>

<div class="nav">
  <button onclick="switchScreen('home')" class="active">Главная</button>
  <button onclick="switchScreen('builder')">Создать</button>
  <button onclick="switchScreen('lookbook')">Образы</button>
</div>

<!-- ГЛАВНАЯ -->
<div id="home" class="screen active">
  <div class="hero">
    <h1>Redefine Your Wardrobe</h1>
    <p>Создавай цифровые образы и управляй стилем.</p>
  </div>
</div>

<!-- СОЗДАТЬ -->
<div id="builder" class="screen">
  <h2>Создать образ</h2>

  <div class="canvas" id="canvas"></div>

  <div class="controls">
    <button class="primary" onclick="fileInput.click()">Добавить фото</button>
    <button class="primary" onclick="deleteActive()">Удалить элемент</button>
    <button class="primary" onclick="saveOutfit()">Сохранить</button>
    <button class="primary" onclick="clearCanvas()">Очистить</button>
  </div>
</div>

<!-- ОБРАЗЫ -->
<div id="lookbook" class="screen">
  <h2>Мои образы</h2>
  <div id="gallery" class="gallery"></div>
</div>

<input type="file" id="fileInput" accept="image/*" multiple style="display:none;">

<script>

let activeElement=null;
let savedOutfits=JSON.parse(localStorage.getItem("outfits"))||[];

const canvas=document.getElementById("canvas");
const gallery=document.getElementById("gallery");
const fileInput=document.getElementById("fileInput");

/* Переключение вкладок */
function switchScreen(id){
  document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  document.querySelectorAll(".nav button").forEach(b=>b.classList.remove("active"));
  document.querySelector(`[onclick="switchScreen('${id}')"]`).classList.add("active");
}

/* Добавление фото */
fileInput.onchange=(e)=>{
  for(let file of e.target.files){
    const reader=new FileReader();
    reader.onload=(event)=>createElement(event.target.result, canvas);
    reader.readAsDataURL(file);
  }
};

/* Создание элемента */
function createElement(src, targetCanvas){

  const el=document.createElement("div");
  el.classList.add("editable");
  el.dataset.x=50;
  el.dataset.y=50;
  el.dataset.scale=1;
  el.dataset.rotation=0;
  el.innerHTML=`<img src="${src}" style="width:120px;">`;

  updateTransform(el);
  targetCanvas.appendChild(el);

  makeInteractive(el);
}

function makeInteractive(el){

  interact(el).draggable({
    listeners:{
      move(event){
        el.dataset.x=parseFloat(el.dataset.x)+event.dx;
        el.dataset.y=parseFloat(el.dataset.y)+event.dy;
        updateTransform(el);
      }
    }
  });

  el.addEventListener("wheel",(e)=>{
    e.preventDefault();
    let scale=parseFloat(el.dataset.scale);
    scale += e.deltaY<0 ? 0.1 : -0.1;
    if(scale<0.2) scale=0.2;
    if(scale>4) scale=4;
    el.dataset.scale=scale;
    updateTransform(el);
  });
}

function updateTransform(el){
  el.style.transform=`
    translate(${el.dataset.x}px,${el.dataset.y}px)
    scale(${el.dataset.scale})
    rotate(${el.dataset.rotation}deg)
  `;
}

function deleteActive(){
  const selected=document.querySelector(".editable.active");
  if(selected) selected.remove();
}

function clearCanvas(){
  canvas.innerHTML="";
}

/* СОХРАНЕНИЕ */
function saveOutfit(){

  const elements=document.querySelectorAll("#canvas .editable");

  if(elements.length===0){
    alert("Добавьте элементы перед сохранением");
    return;
  }

  let outfit=[];
  elements.forEach(el=>{
    outfit.push({
      src:el.querySelector("img").src,
      x:parseFloat(el.dataset.x),
      y:parseFloat(el.dataset.y),
      scale:parseFloat(el.dataset.scale),
      rotation:parseFloat(el.dataset.rotation)
    });
  });

  savedOutfits.push(outfit);
  localStorage.setItem("outfits",JSON.stringify(savedOutfits));

  renderGallery();
  switchScreen("lookbook");

  alert("Образ сохранён");
}

/* ГАЛЕРЕЯ */
function renderGallery(){

  gallery.innerHTML="";

  savedOutfits.forEach((outfit,index)=>{

    const windowDiv=document.createElement("div");
    windowDiv.className="outfit-window";

    outfit.forEach(item=>{

      const el=document.createElement("div");
      el.classList.add("editable");
      el.dataset.x=item.x*0.4;
      el.dataset.y=item.y*0.4;
      el.dataset.scale=item.scale*0.4;
      el.dataset.rotation=item.rotation;
      el.innerHTML=`<img src="${item.src}" style="width:120px;">`;

      updateTransform(el);
      windowDiv.appendChild(el);
      makeInteractive(el);

    });

    gallery.appendChild(windowDiv);

  });

}

renderGallery();

</script>

</body>
</html>
